TASK 7 â€” Execution: Uncertainty-Scaled Sizing + Impact-Aware Planner
server/services/ExecutionRouter.ts:

plan(context) â†’ router choose â†’ signal (long/flat/target).

size(signal, uncertaintyWidth) with 
ğ‘ 
=
ğ‘ 
max
â¡
â‹…
ğœ
(
âˆ’
ğ‘¤
/
ğ‘¤
\*
)
s=s 
max
â€‹
 â‹…Ïƒ(âˆ’w/w 
\*
 ) and vol targeting using vol forecasts; apply CVaR budget via portfolio.ts.

Use server/services/execution/Planner.ts for Immediate/TWAP/VWAP/POV based on spread/depth/micro-vol & urgency; cost 
ğ‘˜
â‹…
size
ğ›¼
+
spread
/
2
kâ‹…size 
Î±
 +spread/2.

execute(plan) â†’ paper order; persist execution record.

Routes:

POST /api/exec/simulate {symbol,size} â†’ plan & cost preview

POST /api/exec/plan-and-execute {symbol} â†’ execution record

GET /api/exec/sizing/last â†’ last sizing snapshot

Tests: tests/execution_planner.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s -X POST localhost:5000/api/exec/simulate -H "Content-Type: application/json" \
  -d '{"symbol":"BTCUSDT","size":0.02}' | jq
curl -s -X POST localhost:5000/api/exec/plan-and-execute -H "Content-Type: application/json" \
  -d '{"symbol":"BTCUSDT"}' | jq
curl -s localhost:5000/api/exec/sizing/last | jq
TASK 8 â€” Portfolio: CVaR Budget + Vol Targeting + Kelly-lite
server/services/portfolio.ts: estimate vol/CVaR (historical sim); solve weights with projected gradient so 
âˆ‘
ğ‘¤
ğ‘–
CVaR
ğ‘–
â‰¤
ğµ
âˆ‘w 
i
â€‹
 CVaR 
i
â€‹
 â‰¤B, portfolio vol â‰ˆ target 
ğœ
âˆ—
Ïƒ 
âˆ—
 . Provide Kelly-lite advisory 
ğ‘“
â‰ˆ
ğœ…
ğœ‡
/
ğœ
2
fâ‰ˆÎºÎ¼/Ïƒ 
2
  (clipped).

Route: POST /api/portfolio/optimize {symbols,cvarBudget,volTarget}.

Tests: tests/portfolio_constraints.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s -X POST localhost:5000/api/portfolio/optimize \
  -H "Content-Type: application/json" \
  -d '{"symbols":["BTCUSDT","ETHUSDT"],"cvarBudget":0.05,"volTarget":0.02}' | jq
TASK 9 â€” Feature Gating (IC + HSIC-lite + Drift)
tools/features/gating.ts: EWMA IC; HSIC-lite (RBF batches); Pageâ€“Hinkley/BOCPD drift; auto-disable bottom decile weekly.

Route: GET /api/features/ranking â†’ [ { feature, ic, hsic, score, disabled } ].

Tests: tests/features_gating.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/features/ranking | jq '.[0:5]'
TASK 10 â€” Promotion (Champion/Challenger via SPA)
server/services/promotion.ts: Hansen SPA (or Deflated Sharpe) on OOS paper PnL; promote if 
ğ‘
<
0.05
p<0.05.

Route: GET /api/promotion/status.

Tests: tests/promotion_spa.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/promotion/status | jq
TASK 11 â€” Off-Policy Learning (Doubly-Robust)
server/services/Counterfactuals.ts: log shadow actions; DR estimator; summary by policy & regime.

Route: GET /api/cf/summary.

Tests: tests/cf_dr.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/cf/summary | jq
TASK 12 â€” Meta-Monitor (Calibration + Nudges)
server/services/MetaMonitor.ts: reliability diagrams, Brier/ECE; compute bounded nudges {routerPriorDelta, sizingCapDelta}.

Routes:

GET /api/meta/quality

POST /api/meta/apply-nudges {}

Tests: tests/meta_monitor.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/meta/quality | jq
curl -s -X POST localhost:5000/api/meta/apply-nudges -H "Content-Type: application/json" -d '{}' | jq
TASK 13 â€” Events â†’ Embeddings (LLM-safe, stub ok)
server/services/events.ts: summarize â†’ embed (or stub hash) â†’ expose for router context; placebo checks for event studies.

Route: GET /api/events/embeddings.

Tests: tests/events_embed.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/events/embeddings | jq '.[0]'
TASK 14 â€” RiskGuards (Caps, Throttle, Drawdown Breaker)
server/services/RiskGuards.ts: global/per-symbol notional caps, orders/min throttle, rolling max-DD breaker with timed reset; enforce in ExecutionRouter.execute().

Route: GET /api/guards/state.

Tests: tests/risk_guards.spec.ts.
Acceptance:

bash
Copy
Edit
curl -s localhost:5000/api/guards/state | jq
# Try to exceed caps and show a blocked response with reason